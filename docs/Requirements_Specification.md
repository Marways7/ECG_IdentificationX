# ECG身份识别系统需求规格说明书

## 1. 项目概述

### 1.1 背景
基于ADS1292R心电采集装置收集的6位测试者(A-F)的心电数据，开发一套基于深度学习的身份识别系统。

### 1.2 数据规格
- **采集设备**: ADS1292R心电信号检测装置
- **采样率**: 250Hz
- **数据格式**: CSV (timestamp, Channel1-ECG, Channel2-RESP, Channel3)
- **测试人数**: 6人 (A-F)
- **单人时长**: 约5分钟
- **数据转换**: `result = (rawdata - mean) × (2 × 2420 × 1000) / (6 × 16777216)`
- **预处理**: 舍弃首尾各1秒数据

---

## 2. 功能需求

### 2.1 信号预处理模块
| 需求ID | 功能描述 | 验证标准 | 状态 |
|--------|----------|----------|------|
| F1.1 | ADC原始数据转换为物理电压值(mV) | 信号幅值范围合理(0.5-2mV) | (✓) |
| F1.2 | 基线漂移去除(高通滤波0.5Hz) | 信号基线稳定 | (✓) |
| F1.3 | 工频干扰滤除(50Hz陷波) | 频谱无50Hz尖峰 | (✓) |
| F1.4 | 高频噪声滤除(低通40Hz) | 信号平滑，波形保留 | (✓) |
| F1.5 | 小波去噪优化 | SNR提升>10dB | (✓) |
| F1.6 | 异常值去除(MAD方法) | 消除采集spike | (✓) |

### 2.2 特征检测模块
| 需求ID | 功能描述 | 验证标准 | 状态 |
|--------|----------|----------|------|
| F2.1 | Pan-Tompkins R峰检测 | 检测准确率>98% | (✓) |
| F2.2 | 心拍分割(R峰前0.25s，后0.45s) | 完整QRS-T波形 | (✓) |
| F2.3 | 心率计算(每10秒窗口) | 与标准值误差<5% | (✓) |

### 2.3 HRV分析模块
| 需求ID | 功能描述 | 验证标准 | 状态 |
|--------|----------|----------|------|
| F3.1 | 时域指标(SDNN/RMSSD/pNN50) | 符合生理范围 | (✓) |
| F3.2 | 频域指标(LF/HF/LF-HF比值) | PSD分析正确 | (✓) |
| F3.3 | 非线性指标(SD1/SD2/ApEn/SampEn) | Poincaré图正确 | (✓) |
| F3.4 | DFA去趋势波动分析 | alpha1/alpha2计算正确 | (✓) |

### 2.4 特征提取模块
| 需求ID | 功能描述 | 验证标准 | 状态 |
|--------|----------|----------|------|
| F4.1 | 频域特征(MFCC倒谱系数) | 13维MFCC+统计量 | (✓) |
| F4.2 | 时域形态特征(QRS/P/T波特征) | 特征值稳定 | (✓) |
| F4.3 | 深度特征(1D-CNN自动提取) | 特征区分度高 | (✓) |

### 2.5 身份识别模块
| 需求ID | 功能描述 | 验证标准 | 状态 |
|--------|----------|----------|------|
| F5.1 | 1D-CNN时域特征网络 | 收敛稳定 | (✓) |
| F5.2 | 训练集/测试集划分(8:2) | 无数据泄露 | (✓) |
| F5.3 | 模型训练和评估 | 准确率>95% | (✓) |

### 2.6 可视化界面
| 需求ID | 功能描述 | 验证标准 | 状态 |
|--------|----------|----------|------|
| F6.1 | 原始/去噪信号对比显示 | 交互流畅 | (✓) |
| F6.2 | R峰检测结果可视化 | 标注准确 | (✓) |
| F6.3 | HRV分析图表展示 | 图表清晰美观 | (✓) |
| F6.4 | 身份识别结果展示 | 混淆矩阵/指标 | (✓) |

---

## 3. 数据集划分

| 数据集 | 样本数 | 比例 | 用途 |
|--------|--------|------|------|
| 训练集 | 1984 | 70% | 模型训练 |
| 验证集 | 284 | 10% | 早停和超参数调优 |
| 测试集 | 568 | 20% | 最终性能评估 |

> 采用分层抽样确保各类别比例一致，随机种子=42保证可复现性

---

## 4. 性能指标 (已达成)

### 4.1 识别性能
| 指标 | 目标 | 实际 |
|------|------|------|
| 测试准确率(Accuracy) | ≥95% | **98.44%** |
| 验证准确率 | - | **99.22%** |
| 精确率(Precision) | ≥93% | **98.45%** |
| 敏感度(Recall) | ≥93% | **98.44%** |
| F1-Score | ≥94% | **98.44%** |

### 4.2 混淆矩阵
```
      A    B    C    D    E    F
A   [72,   0,   1,   0,   0,   0]
B   [ 0, 104,   0,   0,   0,   1]
C   [ 2,   0, 103,   0,   0,   0]
D   [ 0,   0,   1,  78,   0,   1]
E   [ 0,   0,   1,   0,  72,   0]
F   [ 0,   1,   0,   0,   0,  75]
```

---

## 5. 技术架构

### 5.1 算法流程
```
原始ECG → ADC转换(去DC偏移) → 异常值去除 → 带通滤波 → 小波去噪 → R峰检测
                                                                    ↓
                                                              心拍分割
                                                                    ↓
                                                          ┌────────┴────────┐
                                                          ↓                 ↓
                                                     形态特征          深度特征
                                                          ↓                 ↓
                                                          └────────┬────────┘
                                                                   ↓
                                                           1D-CNN分类器
                                                                   ↓
                                                            身份识别结果
```

### 5.2 技术栈
- **后端**: Python 3.10+ / PyTorch 2.0+
- **信号处理**: SciPy / NumPy / PyWavelets
- **前端**: Streamlit (现代化UI)
- **可视化**: Plotly / Matplotlib

---

## 6. 数据统计

| 受试者 | 心拍数量 | 平均心率 |
|--------|----------|----------|
| A | 366 | 102.1 BPM |
| B | 525 | 119.2 BPM |
| C | 522 | 114.1 BPM |
| D | 400 | 86.4 BPM |
| E | 363 | 74.9 BPM |
| F | 382 | 89.5 BPM |
| **总计** | **2558** | - |

---

## 7. 交付成果

1. ✅ 完整可运行的身份识别系统
2. ✅ 识别准确率98.44%的深度学习模型
3. ✅ 美观的Web可视化界面 (Streamlit)
4. ✅ 完整的算法文档和使用说明
5. ✅ 信号处理可视化图表
6. ✅ 混淆矩阵和性能报告
